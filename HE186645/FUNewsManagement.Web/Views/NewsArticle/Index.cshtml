@model IEnumerable<NewsArticleViewModel>
@{
    ViewData["Title"] = "News Articles";
}

<style>
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #f8f9fa;
    }

    .admin-container {
        padding: 60px 0;
    }

    .page-title {
        color: white;
        font-weight: 700;
    }

    .search-form {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }

    .form-control, .form-select {
        background: rgba(255,255,255,0.9);
        border: none;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-search, .btn-create {
        transition: all 0.3s;
    }

    .btn-search {
        background: linear-gradient(90deg, #667eea, #764ba2);
        border: none;
    }

    .btn-create {
        background: linear-gradient(90deg, #28a745, #20c997);
        border: none;
    }

        .btn-create:hover, .btn-search:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102,126,234,0.4);
        }

    .table-admin {
        background: white;
        border-radius: 1.25rem;
        overflow: hidden;
        box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        color: #2c3e50;
    }

    .table thead th {
        background: linear-gradient(90deg, #667eea, #764ba2);
        color: white;
        border: none;
    }

    .table tbody tr {
        transition: all 0.3s;
    }

        .table tbody tr:hover {
            background: #f1f3f5;
            transform: scale(1.01);
        }

    .btn-action {
        min-width: 38px;
        transition: all 0.3s;
    }

        .btn-action:hover {
            transform: translateY(-2px);
        }

    .badge-status {
        font-size: 0.9rem;
        padding: 0.5em 1em;
        border-radius: 2rem;
    }

    .no-data {
        background: rgba(255,255,255,0.9);
        border-radius: 1rem;
        padding: 3rem;
        text-align: center;
        color: #495057;
    }
</style>

<!-- FORM ẨN ĐỂ CÓ ANTIFORGERY TOKEN -->
<form id="tokenForm" style="display:none;">
    @Html.AntiForgeryToken()
</form>

<div class="admin-container">
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h2 class="page-title display-5 fw-bold">
                <i class="fas fa-newspaper me-3"></i>Quản lý Bài viết
            </h2>
            <hr class="w-25 mx-auto border-light opacity-75" />
        </div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show shadow mb-4" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Search & Filter Form -->
    <div class="row justify-content-center mb-5">
        <div class="col-lg-11">
            <form method="get" class="search-form row g-3 align-items-center">
                <div class="col-md-4">
                    <input type="text" name="searchTerm" class="form-control form-control-lg"
                           placeholder="Tìm kiếm tiêu đề..." value="@ViewBag.SearchTerm" />
                </div>
                <div class="col-md-3">
                    <select name="categoryId" class="form-select form-select-lg">
                        <option value="">Tất cả danh mục</option>
                        @foreach (var cat in ViewBag.Categories)
                        {
                            <option value="@cat.CategoryID" selected="@(ViewBag.SelectedCategory == cat.CategoryID ? "selected" : null)">@cat.CategoryName</option>
                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <select name="status" class="form-select form-select-lg">
                        <option value="">Tất cả trạng thái</option>
                        <option value="true" selected="@(ViewBag.SelectedStatus == "true" ? "selected" : null)">Active</option>
                        <option value="false" selected="@(ViewBag.SelectedStatus == "false" ? "selected" : null)">Inactive</option>
                    </select>
                </div>
                <div class="col-md-2 col-sm-6">
                    <button type="submit" class="btn btn-search btn-lg w-100">
                        <i class="fas fa-search me-2"></i>Tìm kiếm
                    </button>
                </div>
                <div class="col-md-1 col-sm-6">
                    <a asp-action="Create" class="btn btn-create btn-lg w-100">
                        <i class="fas fa-plus"></i> Tạo mới
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Articles Table -->
    <div class="table-responsive">
        <table class="table table-admin table-striped table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tiêu đề</th>
                    <th>Headline</th>
                    <th>Danh mục</th>
                    <th>Tác giả</th>
                    <th>Ngày tạo</th>
                    <th>Trạng thái</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    @foreach (var article in Model)
                    {
                        <tr>
                            <td>@article.NewsArticleID</td>
                            <td class="fw-bold">@article.NewsTitle</td>
                            <td>@article.Headline</td>
                            <td>@article.CategoryName</td>
                            <td>@article.CreatedByName</td>
                            <td>@article.CreatedDate?.ToString("dd/MM/yyyy")</td>
                            <td>
                                @if (article.NewsStatus)
                                {
                                    <span class="badge bg-success badge-status">Active</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary badge-status">Inactive</span>
                                }
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <a asp-action="Edit" asp-route-id="@article.NewsArticleID"
                                       class="btn btn-warning btn-action" title="Sửa">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button class="btn btn-info btn-action" title="Sao chép"
                                            onclick="duplicateArticle('@article.NewsArticleID')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                    <button class="btn btn-danger btn-action" title="Xóa"
                                            onclick="deleteArticle('@article.NewsArticleID')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="8">
                            <div class="no-data">
                                <i class="fas fa-info-circle fa-3x text-primary mb-3"></i>
                                <h4>Không tìm thấy bài viết nào</h4>
                                <p class="text-muted">Hãy thử thay đổi bộ lọc hoặc tạo bài viết mới!</p>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
     <!-- nếu cần -->

    <script>
        function getToken() {
            return document.querySelector('input[name="__RequestVerificationToken"]').value;
        }

        function deleteArticle(id) {
            if (confirm('Bạn chắc chắn muốn xóa bài viết này?')) {
                fetch('/NewsArticle/Delete/' + id, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': getToken()
                    }
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) location.reload();
                })
                .catch(error => alert('Lỗi: ' + error));
            }
        }

        function duplicateArticle(id) {
            if (confirm('Tạo bản sao của bài viết này?')) {
                fetch('/NewsArticle/Duplicate/' + id, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': getToken()
                    }
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) location.reload();
                })
                .catch(error => alert('Lỗi: ' + error));
            }
        }
    </script>
}